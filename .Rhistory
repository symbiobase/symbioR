facet_wrap(~ clade + host_species, scales = "free_y", ncol = 1, strip.position = "right") +
theme_bw() +
theme(axis.text.y = element_text(size = 6),
strip.text.y = element_text(angle = 0),
legend.position = "none") +
xlab("Abundance") + ylab("") +
scale_fill_manual(values = colour.seqs_new)
colour.seqs_new <- extract_plot_colors(folder_path_trid)
ggplot(data = merged_sequences) +
geom_bar(aes(y = sample_name, x = relative_abundance, fill = seq_ID),
stat = "identity", position = "stack") +
facet_wrap(~ clade + host_species, scales = "free_y", ncol = 1, strip.position = "right") +
theme_bw() +
theme(axis.text.y = element_text(size = 6),
strip.text.y = element_text(angle = 0),
legend.position = "none") +
xlab("Abundance") + ylab("")  +
scale_fill_manual(values = colour.seqs_new)
ggplot(data = merged_sequences) +
geom_bar(aes(y = sample_name, x = absolute_abundance, fill = seq_ID),
stat = "identity", position = "stack") +
scale_x_continuous(trans = "pseudo_log", breaks = c(-1e6, -1e5, -1e4, -1e3, -1e2, -1, 0), limits = c(-546323, 0)) +
facet_wrap(~ clade + host_species, scales = "free_y", ncol = 1, strip.position = "right") +
theme_bw() +
theme(axis.text.y = element_text(size = 6),
strip.text.y = element_text(angle = 0),
legend.position = "none") +
xlab("Abundance") + ylab("") +
scale_fill_manual(values = colour.seqs_new)
ggplot(data = merged_sequences) +
geom_bar(aes(y = sample_name, x = absolute_abundance, fill = seq_ID),
stat = "identity", position = "stack") +
scale_x_continuous(trans = "pseudo_log", breaks = c(-1e6, -1e5, -1e4, -1e3, -1e2, -1, 0), limits = c(-546323, 0)) +
facet_wrap(~ clade + host_species, scales = "free_y", ncol = 1, strip.position = "right") +
theme_bw() +
theme(axis.text.y = element_text(size = 6),
strip.text.y = element_text(angle = 0),
legend.position = "none") +
xlab("Abundance") + ylab("") +
scale_fill_manual(values = colour.seqs_new)
ggplot(data = merged_sequences) +
geom_bar(aes(y = sample_name, x = relative_abundance, fill = seq_ID),
stat = "identity", position = "stack") +
facet_wrap(~ clade + host_species, scales = "free_y", ncol = 1, strip.position = "right") +
theme_bw() +
theme(axis.text.y = element_text(size = 6),
strip.text.y = element_text(angle = 0),
legend.position = "none") +
xlab("Abundance") + ylab("")  +
scale_fill_manual(values = colour.seqs_new)
ggplot(data = merged_sequences) +
geom_bar(aes(y = sample_name, x = relative_abundance, fill = seq_ID),
stat = "identity", position = "stack") +
facet_wrap(host_species~ clade  , scales = "free_y", ncol = 1, strip.position = "right") +
theme_bw() +
theme(axis.text.y = element_text(size = 6),
strip.text.y = element_text(angle = 0),
legend.position = "none") +
xlab("Abundance") + ylab("")  +
scale_fill_manual(values = colour.seqs_new)
library(patchwork)
p1 <- ggplot(data = merged_sequences) +
geom_bar(aes(y = sample_name, x = relative_abundance, fill = seq_ID),
stat = "identity", position = "stack") +
facet_wrap(host_species ~ clade, scales = "free_y", ncol = 1, strip.position = "right") +
theme_bw() +
theme(axis.text.y = element_blank(),
strip.text.y = element_text(angle = 0),
legend.position = "none") +
xlab("Relative abundance") + ylab("") +
scale_fill_manual(values = colour.seqs_new)
p2 <- ggplot(data = merged_sequences) +
geom_bar(aes(y = sample_name, x = absolute_abundance, fill = seq_ID),
stat = "identity", position = "stack") +
scale_x_continuous(trans = "pseudo_log",
breaks = c(-1e6, -1e5, -1e4, -1e3, -1e2, -1, 0),
limits = c(-546323, 0)) +
theme_bw() +
theme(axis.text.y = element_text(size = 6),
strip.background = element_blank(),
strip.text = element_blank(),
legend.position = "none") +
xlab("Absolute abundance") + ylab("") +
scale_fill_manual(values = colour.seqs_new)
p2 + p1 + plot_layout(ncol = 2, widths = c(1, 1))
p1 + p2 + plot_layout(ncol = 2, widths = c(1, 1))
p2 + p1 + plot_layout(ncol = 2, widths = c(1, 1))
p1 <- ggplot(data = merged_sequences) +
geom_bar(aes(y = sample_name, x = relative_abundance, fill = seq_ID),
stat = "identity", position = "stack") +
# facet_wrap(host_species ~ clade, scales = "free_y", ncol = 1, strip.position = "right") +
theme_bw() +
theme(axis.text.y = element_blank(),
strip.text.y = element_text(angle = 0),
legend.position = "none") +
xlab("Relative abundance") + ylab("") +
scale_fill_manual(values = colour.seqs_new)
p2 <- ggplot(data = merged_sequences) +
geom_bar(aes(y = sample_name, x = absolute_abundance, fill = seq_ID),
stat = "identity", position = "stack") +
scale_x_continuous(trans = "pseudo_log",
breaks = c(-1e6, -1e5, -1e4, -1e3, -1e2, -1, 0),
limits = c(-546323, 0)) +
facet_wrap(host_species ~ clade, scales = "free_y", ncol = 1, strip.position = "right") +
theme_bw() +
theme(axis.text.y = element_text(size = 6),
strip.background = element_blank(),
strip.text = element_blank(),
legend.position = "none") +
xlab("Absolute abundance") + ylab("") +
scale_fill_manual(values = colour.seqs_new)
p2 + p1 + plot_layout(ncol = 2, widths = c(1, 1))
p1 <- ggplot(data = merged_sequences) +
geom_bar(aes(y = sample_name, x = relative_abundance, fill = seq_ID),
stat = "identity", position = "stack") +
facet_wrap(host_species ~ clade, scales = "free_y", ncol = 1, strip.position = "right") +
theme_bw() +
theme(axis.text.y = element_blank(),
strip.text.y = element_text(angle = 0),
legend.position = "none") +
xlab("Relative abundance") + ylab("") +
scale_fill_manual(values = colour.seqs_new)
p2 <- ggplot(data = merged_sequences) +
geom_bar(aes(y = sample_name, x = absolute_abundance, fill = seq_ID),
stat = "identity", position = "stack") +
scale_x_continuous(trans = "pseudo_log",
breaks = c(-1e6, -1e5, -1e4, -1e3, -1e2, -1, 0),
limits = c(-546323, 0)) +
facet_wrap(host_species ~ clade, scales = "free_y", ncol = 1, strip.position = "right") +
theme_bw() +
theme(axis.text.y = element_text(size = 6),
strip.background = element_blank(),
strip.text = element_blank(),
legend.position = "none") +
xlab("Absolute abundance") + ylab("") +
scale_fill_manual(values = colour.seqs_new)
p2 + p1 + plot_layout(ncol = 2, widths = c(1, 1))
p1 <- ggplot(data = merged_sequences) +
geom_bar(aes(y = sample_name, x = relative_abundance, fill = seq_ID),
stat = "identity", position = "stack") +
facet_wrap(host_species ~ clade, scales = "free_y", ncol = 1, strip.position = "right") +
theme_bw() +
theme(axis.text.y = element_text(size = 6),
strip.background = element_blank(),
strip.text = element_blank(),
legend.position = "none") +
xlab("Relative abundance") + ylab("") +
scale_fill_manual(values = colour.seqs_new)
p2 <- ggplot(data = merged_sequences) +
geom_bar(aes(y = sample_name, x = absolute_abundance, fill = seq_ID),
stat = "identity", position = "stack") +
scale_x_continuous(trans = "pseudo_log",
breaks = c(-1e6, -1e5, -1e4, -1e3, -1e2, -1, 0),
limits = c(-546323, 0)) +
facet_wrap(host_species ~ clade, scales = "free_y", ncol = 1, strip.position = "right") +
theme_bw() +
theme(axis.text.y = element_blank(),
strip.text.y = element_text(angle = 0),
legend.position = "none") +
xlab("Absolute abundance") + ylab("") +
scale_fill_manual(values = colour.seqs_new)
p2 + p1 + plot_layout(ncol = 2, widths = c(1, 1))
p1 <- ggplot(data = merged_sequences) +
geom_bar(aes(y = sample_name, x = relative_abundance, fill = seq_ID),
stat = "identity", position = "stack") +
theme_bw() +
theme(axis.text.y = element_text(size = 6),
strip.background = element_blank(),
strip.text = element_blank(),
legend.position = "none") +
xlab("Relative abundance") + ylab("") +
scale_fill_manual(values = colour.seqs_new)
p2 <- ggplot(data = merged_sequences) +
geom_bar(aes(y = sample_name, x = absolute_abundance, fill = seq_ID),
stat = "identity", position = "stack") +
scale_x_continuous(trans = "pseudo_log",
breaks = c(-1e6, -1e5, -1e4, -1e3, -1e2, -1, 0),
limits = c(-546323, 0)) +
facet_wrap(host_species ~ clade, scales = "free_y", ncol = 1, strip.position = "right") +
theme_bw() +
theme(axis.text.y = element_text(size = 6),
strip.text.y = element_text(angle = 0),
legend.position = "none") +
xlab("Absolute abundance") + ylab("") +
scale_fill_manual(values = colour.seqs_new)
p2 + p1 + plot_layout(ncol = 2, widths = c(1, 1))
p1 <- ggplot(data = merged_sequences) +
geom_bar(aes(y = sample_name, x = relative_abundance, fill = seq_ID),
stat = "identity", position = "stack") +
facet_wrap(host_species ~ clade, scales = "free_y", ncol = 1, strip.position = "right") +
theme_bw() +
theme(axis.text.y = element_text(size = 6),
strip.background = element_blank(),
strip.text = element_blank(),
panel.spacing = unit(0.5, "lines"),
legend.position = "none") +
xlab("Relative abundance") + ylab("") +
scale_fill_manual(values = colour.seqs_new)
p2 <- ggplot(data = merged_sequences) +
geom_bar(aes(y = sample_name, x = absolute_abundance, fill = seq_ID),
stat = "identity", position = "stack") +
scale_x_continuous(trans = "pseudo_log",
breaks = c(-1e6, -1e5, -1e4, -1e3, -1e2, -1, 0),
limits = c(-546323, 0)) +
facet_wrap(host_species ~ clade, scales = "free_y", ncol = 1, strip.position = "right") +
theme_bw() +
theme(axis.text.y = element_blank(),
strip.text.y = element_text(angle = 0),
panel.spacing = unit(0.5, "lines"),
legend.position = "none") +
xlab("Absolute abundance") + ylab("") +
scale_fill_manual(values = colour.seqs_new)
p2 + p1 + plot_layout(ncol = 2, widths = c(1, 1))
p1 <- ggplot(data = merged_sequences) +
geom_bar(aes(y = sample_name, x = relative_abundance, fill = seq_ID),
stat = "identity", position = "stack") +
facet_wrap(host_species ~ clade, scales = "free_y", ncol = 1, strip.position = "right") +
theme_bw() +
theme(axis.text.y = element_text(size = 6, hjust = 0, vjust = 0.5),
axis.ticks.y = element_blank(),
strip.background = element_blank(),
strip.text = element_blank(),
panel.spacing = unit(0.5, "lines"),
legend.position = "none") +
xlab("Relative abundance") + ylab("") +
scale_fill_manual(values = colour.seqs_new) +
scale_y_discrete(position = "right")
p2 <- ggplot(data = merged_sequences) +
geom_bar(aes(y = sample_name, x = absolute_abundance, fill = seq_ID),
stat = "identity", position = "stack") +
scale_x_continuous(trans = "pseudo_log",
breaks = c(-1e6, -1e5, -1e4, -1e3, -1e2, -1, 0),
limits = c(-546323, 0)) +
facet_wrap(host_species ~ clade, scales = "free_y", ncol = 1, strip.position = "right") +
theme_bw() +
theme(axis.text.y = element_text(size = 6, hjust = 1, vjust = 0.5),
strip.text.y = element_text(angle = 0),
panel.spacing = unit(0.5, "lines"),
legend.position = "none") +
xlab("Absolute abundance") + ylab("") +
scale_fill_manual(values = colour.seqs_new)
p2 + p1 + plot_layout(ncol = 2, widths = c(1, 1))
p2 <- ggplot(data = merged_sequences) +
geom_bar(aes(y = sample_name, x = absolute_abundance, fill = seq_ID),
stat = "identity", position = "stack") +
scale_x_continuous(trans = "pseudo_log",
breaks = c(-1e6, -1e5, -1e4, -1e3, -1e2, -1, 0),
limits = c(-546323, 0)) +
facet_wrap(host_species ~ clade, scales = "free_y", ncol = 1, strip.position = "left") +
theme_bw() +
theme(axis.text.y = element_blank(),
axis.ticks.y = element_blank(),
strip.text.y.left = element_text(angle = 0),
strip.text.y.right = element_blank(),
panel.spacing = unit(0.5, "lines"),
legend.position = "none") +
xlab("Absolute abundance") + ylab("") +
scale_fill_manual(values = colour.seqs_new)
p1 <- ggplot(data = merged_sequences) +
geom_bar(aes(y = sample_name, x = relative_abundance, fill = seq_ID),
stat = "identity", position = "stack") +
facet_wrap(host_species ~ clade, scales = "free_y", ncol = 1, strip.position = "right") +
theme_bw() +
theme(axis.text.y = element_text(size = 6, hjust = 0, vjust = 0.5),
axis.ticks.y = element_blank(),
strip.background = element_blank(),
strip.text = element_blank(),
panel.spacing = unit(0.5, "lines"),
legend.position = "none") +
xlab("Relative abundance") + ylab("") +
scale_fill_manual(values = colour.seqs_new) +
scale_y_discrete(position = "right")
p2 + p1 + plot_layout(ncol = 2, widths = c(1, 1))
p2 <- ggplot(data = merged_sequences) +
geom_bar(aes(y = sample_name, x = absolute_abundance, fill = seq_ID),
stat = "identity", position = "stack") +
scale_x_continuous(trans = "pseudo_log",
breaks = c(-1e6, -1e5, -1e4, -1e3, -1e2, -1, 0),
limits = c(-546323, 0)) +
facet_wrap(host_species ~ clade, scales = "free_y", ncol = 1, strip.position = "left") +
theme_bw() +
theme(axis.text.y = element_blank(),
axis.ticks.y = element_blank(),
strip.text.y.left = element_text(angle = 0),
strip.text.y.right = element_blank(),
panel.spacing = unit(0.5, "lines"),
legend.position = "none",
plot.margin = margin(t = 5, r = 0, b = 5, l = 5)) +
xlab("Absolute abundance") + ylab("") +
scale_fill_manual(values = colour.seqs_new)
p1 <- ggplot(data = merged_sequences) +
geom_bar(aes(y = sample_name, x = relative_abundance, fill = seq_ID),
stat = "identity", position = "stack") +
facet_wrap(host_species ~ clade, scales = "free_y", ncol = 1, strip.position = "right") +
theme_bw() +
theme(axis.text.y = element_text(size = 6, hjust = 0, vjust = 0.5),
axis.ticks.y = element_blank(),
strip.background = element_blank(),
strip.text = element_blank(),
panel.spacing = unit(0.5, "lines"),
legend.position = "none",
plot.margin = margin(t = 5, r = 5, b = 5, l = 0)) +
xlab("Relative abundance") + ylab("") +
scale_fill_manual(values = colour.seqs_new) +
scale_y_discrete(position = "right")
p2 + p1 + plot_layout(ncol = 2, widths = c(1, 1))
p2 <- ggplot(data = merged_sequences |> filter(host_species=="maxima")) +
geom_bar(aes(y = sample_name, x = absolute_abundance, fill = seq_ID),
stat = "identity", position = "stack") +
scale_x_continuous(trans = "pseudo_log",
breaks = c(-1e6, -1e5, -1e4, -1e3, -1e2, -1, 0),
limits = c(-546323, 0)) +
facet_wrap(host_species ~ clade, scales = "free_y", ncol = 1, strip.position = "left") +
theme_bw() +
theme(axis.text.y = element_blank(),
axis.ticks.y = element_blank(),
strip.text.y.left = element_text(angle = 0),
strip.text.y.right = element_blank(),
panel.spacing = unit(0.5, "lines"),
legend.position = "none",
plot.margin = margin(t = 5, r = 0, b = 5, l = 5)) +
xlab("Absolute abundance") + ylab("") +
scale_fill_manual(values = colour.seqs_new)
p1 <- ggplot(data = merged_sequences |> filter(host_species=="maxima")) +
geom_bar(aes(y = sample_name, x = relative_abundance, fill = seq_ID),
stat = "identity", position = "stack") +
facet_wrap(host_species ~ clade, scales = "free_y", ncol = 1, strip.position = "right") +
theme_bw() +
theme(axis.text.y = element_text(size = 6, hjust = 0, vjust = 0.5),
axis.ticks.y = element_blank(),
strip.background = element_blank(),
strip.text = element_blank(),
panel.spacing = unit(0.5, "lines"),
legend.position = "none",
plot.margin = margin(t = 5, r = 5, b = 5, l = 0)) +
xlab("Relative abundance") + ylab("") +
scale_fill_manual(values = colour.seqs_new) +
scale_y_discrete(position = "right")
p2 + p1 + plot_layout(ncol = 2, widths = c(1, 1))
p2 <- ggplot(data = merged_sequences, aes(y = fct_rev(factor(sample_name)), x = absolute_abundance, fill = seq_ID)) +
geom_bar(stat = "identity", position = "stack") +
scale_x_continuous(trans = "pseudo_log",
breaks = c(-1e6, -1e5, -1e4, -1e3, -1e2, -1, 0),
limits = c(-546323, 0)) +
facet_wrap(host_species ~ clade, scales = "free_y", ncol = 1, strip.position = "left") +
theme_bw() +
theme(axis.text.y = element_blank(),
axis.ticks.y = element_blank(),
strip.text.y.left = element_text(angle = 0),
strip.text.y.right = element_blank(),
panel.spacing = unit(0.5, "lines"),
legend.position = "none",
plot.margin = margin(t = 5, r = 0, b = 5, l = 5)) +
xlab("Absolute abundance") + ylab("") +
scale_fill_manual(values = colour.seqs_new)
p1 <- ggplot(data = merged_sequences, aes(y = fct_rev(factor(sample_name)), x = relative_abundance, fill = seq_ID)) +
geom_bar(stat = "identity", position = "stack") +
facet_wrap(host_species ~ clade, scales = "free_y", ncol = 1, strip.position = "right") +
theme_bw() +
theme(axis.text.y = element_text(size = 6, hjust = 0, vjust = 0.5),
axis.ticks.y = element_blank(),
strip.background = element_blank(),
strip.text = element_blank(),
panel.spacing = unit(0.5, "lines"),
legend.position = "none",
plot.margin = margin(t = 5, r = 5, b = 5, l = 0)) +
xlab("Relative abundance") + ylab("") +
scale_fill_manual(values = colour.seqs_new) +
scale_y_discrete(position = "right")
p2 + p1 + plot_layout(ncol = 2, widths = c(1, 1))
merged_sequences <- merged_sequences %>%
mutate(sample_name = factor(sample_name, levels = unique(sample_name)))  # consistent order
p2 <- ggplot(data = merged_sequences, aes(y = sample_name, x = absolute_abundance, fill = seq_ID)) +
geom_bar(stat = "identity", position = "stack") +
scale_x_continuous(trans = "pseudo_log",
breaks = c(-1e6, -1e5, -1e4, -1e3, -1e2, -1, 0),
limits = c(-546323, 0)) +
facet_wrap(host_species ~ clade, ncol = 1, strip.position = "left") +
theme_bw() +
theme(axis.text.y = element_blank(),
axis.ticks.y = element_blank(),
strip.text.y.left = element_text(angle = 0),
strip.text.y.right = element_blank(),
panel.spacing = unit(0, "lines"),
legend.position = "none",
plot.margin = margin(t = 5, r = 0, b = 5, l = 5)) +
xlab("Absolute abundance") + ylab("") +
scale_fill_manual(values = colour.seqs_new)
p1 <- ggplot(data = merged_sequences, aes(y = sample_name, x = relative_abundance, fill = seq_ID)) +
geom_bar(stat = "identity", position = "stack") +
facet_wrap(host_species ~ clade, ncol = 1, strip.position = "right") +
theme_bw() +
theme(axis.text.y = element_text(size = 6),
axis.ticks.y = element_blank(),
strip.background = element_blank(),
strip.text = element_blank(),
panel.spacing = unit(0, "lines"),
legend.position = "none",
plot.margin = margin(t = 5, r = 5, b = 5, l = 0)) +
xlab("Relative abundance") + ylab("") +
scale_fill_manual(values = colour.seqs_new) +
scale_y_discrete(position = "right")
p2 + p1 + plot_layout(ncol = 2, widths = c(1, 1))
# Remove unused factor levels within each facet group
merged_sequences <- merged_sequences %>%
filter(!is.na(sample_name)) %>%
droplevels()
# Reorder sample_name consistently by abundance to ensure matching facet rows
sample_order <- merged_sequences %>%
group_by(sample_name) %>%
summarise(total = sum(abs(absolute_abundance) + relative_abundance)) %>%
arrange(desc(total)) %>%
pull(sample_name)
merged_sequences <- merged_sequences %>%
mutate(sample_name = factor(sample_name, levels = sample_order))
# Plot 1: Absolute abundance
p2 <- ggplot(merged_sequences, aes(y = sample_name, x = absolute_abundance, fill = seq_ID)) +
geom_bar(stat = "identity", position = "stack") +
scale_x_continuous(trans = "pseudo_log",
breaks = c(-1e6, -1e5, -1e4, -1e3, -1e2, -1, 0),
limits = c(-546323, 0)) +
facet_wrap(host_species ~ clade, ncol = 1, strip.position = "left") +
theme_bw() +
theme(axis.text.y = element_blank(),
axis.ticks.y = element_blank(),
strip.text.y.left = element_text(angle = 0),
strip.text.y.right = element_blank(),
panel.spacing = unit(0, "lines"),
legend.position = "none",
plot.margin = margin(t = 5, r = 0, b = 5, l = 5)) +
xlab("Absolute abundance") + ylab("") +
scale_fill_manual(values = colour.seqs_new)
# Plot 2: Relative abundance
p1 <- ggplot(merged_sequences, aes(y = sample_name, x = relative_abundance, fill = seq_ID)) +
geom_bar(stat = "identity", position = "stack") +
facet_wrap(host_species ~ clade, ncol = 1, strip.position = "right") +
theme_bw() +
theme(axis.text.y = element_text(size = 6),
axis.ticks.y = element_blank(),
strip.background = element_blank(),
strip.text = element_blank(),
panel.spacing = unit(0, "lines"),
legend.position = "none",
plot.margin = margin(t = 5, r = 5, b = 5, l = 0)) +
xlab("Relative abundance") + ylab("") +
scale_fill_manual(values = colour.seqs_new) +
scale_y_discrete(position = "right")
p2 + p1 + plot_layout(ncol = 2, widths = c(1, 1))
p2 <- ggplot(data = merged_sequences |> filter(host_species=="maxima")) +
geom_bar(aes(y = sample_name, x = absolute_abundance, fill = seq_ID),
stat = "identity", position = "stack") +
scale_x_continuous(trans = "pseudo_log",
breaks = c(-1e6, -1e5, -1e4, -1e3, -1e2, -1, 0),
limits = c(-546323, 0)) +
facet_wrap(host_species ~ clade,  ncol = 1, strip.position = "left") +
theme_bw() +
theme(axis.text.y = element_blank(),
axis.ticks.y = element_blank(),
strip.text.y.left = element_text(angle = 0),
strip.text.y.right = element_blank(),
panel.spacing = unit(0.5, "lines"),
legend.position = "none",
plot.margin = margin(t = 5, r = 0, b = 5, l = 5)) +
xlab("Absolute abundance") + ylab("") +
scale_fill_manual(values = colour.seqs_new)
p1 <- ggplot(data = merged_sequences |> filter(host_species=="maxima")) +
geom_bar(aes(y = sample_name, x = relative_abundance, fill = seq_ID),
stat = "identity", position = "stack") +
facet_wrap(host_species ~ clade,  ncol = 1, strip.position = "right") +
theme_bw() +
theme(axis.text.y = element_text(size = 6, hjust = 0, vjust = 0.5),
axis.ticks.y = element_blank(),
strip.background = element_blank(),
strip.text = element_blank(),
panel.spacing = unit(0.5, "lines"),
legend.position = "none",
plot.margin = margin(t = 5, r = 5, b = 5, l = 0)) +
xlab("Relative abundance") + ylab("") +
scale_fill_manual(values = colour.seqs_new) +
scale_y_discrete(position = "right")
p2 + p1 + plot_layout(ncol = 2, widths = c(1, 1))
install.packages(c("ggplot2", "gganimate", "gifski", "transformr"))
install.packages(c("ggplot2", "gganimate", "gifski", "transformr"))
library(deSolve)
library(ggplot2)
library(gganimate)
# Define the Lotka-Volterra model
lotka_volterra <- function(t, state, parameters) {
with(as.list(c(state, parameters)), {
dPrey <- r * Prey - a * Prey * Predator
dPredator <- b * Prey * Predator - m * Predator
list(c(dPrey, dPredator))
})
}
# Initial state and parameters
state <- c(Prey = 40, Predator = 9)
parameters <- c(r = 0.6, a = 0.025, b = 0.01, m = 0.4)
times <- seq(0, 200, by = 0.5)
# Solve ODE
out <- as.data.frame(ode(y = state, times = times, func = lotka_volterra, parms = parameters))
# Convert to long format for ggplot
library(tidyr)
df_long <- pivot_longer(out, cols = c("Prey", "Predator"), names_to = "Species", values_to = "Population")
# Animated ggplot
p <- ggplot(df_long, aes(x = time, y = Population, color = Species)) +
geom_line(size = 1.2) +
labs(title = 'Lotka-Volterra Predator-Prey Dynamics', x = 'Time', y = 'Population Size') +
scale_color_manual(values = c("Prey" = "darkgreen", "Predator" = "firebrick")) +
theme_minimal(base_size = 14) +
transition_reveal(time)
# Render and save as GIF
anim_save("lotka_volterra_timeseries.gif", p, renderer = gifski_renderer())
