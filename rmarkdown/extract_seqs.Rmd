---
title: "extract_seqs"
date: "`r Sys.Date()`"
---


```{r, warning=FALSE, message=FALSE}
library(tidyverse)
library(ggplot2)
library(devtools)
library(symportalfunctions)
#library(lattice)

```

# extract_seqs_long

Extracts sequences from "`seqs.absolute.abund_and_meta.txt`" in the `post_med_seqs` folder.

-   `folder` = name of the [**main**]{.underline} folder for symportal \*
-   `type` = "absolute" or "relative" abundance
-   `clade` = vector of clade types to keep, can be single, e.g. clade="C", or multiple e.g. clade=c("C", "D")
-   `threshold` = threshold threshold to remove samples, `1000` by default
-   `drop_samples` = drop samples by named vector, e.g. c("H00B07", "H00B06"), or by one or more partial matches, e.g. c("07","B06") \*\*
-   `drop_seqs` = drop seqs by named vector, e.g. c("X2777817_G", "X2777816_G"), or by one or more partial matches, e.g. c("X2","OT") \*\*
-   `silent` = either `TRUE` or `FALSE`, show which samples were removed by name

### Notes:

\* the `folder` name should be [only]{.underline} the base folder. For example, the folder for the following location `("20220919T102058_esampayo/post_med_seqs/224_20220926T061917_DBV_20220926T133809.seqs.absolute.abund_and_meta.txt")` should be: `(folder="20220919T102058_esampayo"`). The function will locate the correct txt file (`"...seqs.absolute.abund_and_meta.txt"`) automatically.

\*\* both `drop_samples` and `drop_seqs` accept either full names or partial matches for seqs and samples. Be careful to specify the exact full sample name or it will filter by a partial match.

## extract_seqs_long examples

### i) get the absolute abundance of all sequences

```{r, code.folding="show"}

folder_path <- ("/Volumes/Macintosh HD/Users/rof011/symbiodinium/20230120T102936_esampayo") 

tmp <- extract_seqs_long(folder_path, type="absolute")

datatable_seqs(tmp)
```

### ii) get the absolute abundance of C and D sequences:

```{r, code.folding="show"}


tmp <- extract_seqs_long(folder_path, type="absolute", clade=c("C", "D"))

datatable_seqs(tmp)
```

### iii) get the relative abundance of C sequences:

```{r, code.folding="show"}
tmp <- extract_seqs_long(folder_path, type="relative", clade="C")

datatable_seqs(tmp)
```

### iv) remove samples with \<100 seqs in total:

The threshold threshold by default is to include all seqss, changing it here manually will increase this threshold to 100 seqs

```{r, code.folding="show"}
tmp <- extract_seqs_long(folder=folder_path, type="relative", clade="C", threshold=100)

datatable_seqs(tmp)
```

### iv) remove samples with \<5000 seqs in total:

The threshold threshold by default is to include all seqs, changing it here manually will increase the threshold to 100 seqs

```{r, code.folding="show"}
tmp <- extract_seqs_long(folder=folder_path, type="absolute", clade="D", threshold=500)

datatable_seqs(tmp)
```

### v) drop samples containing "OT" and "H18"

The threshold threshold by default is 1000 seqs, changing it here manually will lower this threshold to 100 seqs

```{r, code.folding="show"}
tmp <- extract_seqs_long(folder=folder_path, type="relative", drop_samples = c("OT", "H18"), silent=FALSE)

datatable_seqs(tmp)
```

### vi) drop seqs containing "OT" and "H18"

The default setting is `silent=TRUE`, set to `FALSE` to print removed sample names below the threshold

```{r, code.folding="show"}
tmp <- extract_seqs_long(folder=folder_path, type="relative", drop_seqs=c("X", "G"), silent=FALSE)

datatable_seqs(tmp)
```

### vi) drop seqs and samples, list removed names

The default setting is `silent=TRUE`, set to `FALSE` to print removed sample names below the threshold

```{r, code.folding="show"}
tmp <- extract_seqs_long(folder=folder_path, type="relative", drop_seqs=c("X", "G"), drop_samples = c("OT", "H18"), silent=FALSE)

datatable_seqs(tmp)
```
